<header class="nav-header">
  <nav class="nav">
    <a href="/" class="nav-brand">FPL Manager Watch</a>

    <button
      id="hamburger-btn"
      class="nav-toggle"
      type="button"
      aria-label="Toggle navigation"
      aria-expanded="false"
      aria-controls="nav-menu"
    >
      <span class="nav-toggle-bar"></span>
      <span class="nav-toggle-bar"></span>
      <span class="nav-toggle-bar"></span>
    </button>

    <div id="nav-menu" class="nav-menu">
      <div class="nav-links">
        <a href="/" class="nav-link">Home</a>
        <a href="/managers" class="nav-link">Managers</a>
        <a href="/transfers" class="nav-link">Transfers</a>
        <a href="/chips" class="nav-link">Chips</a>
        <a href="/stats" class="nav-link">Stats</a>
        <a href="/ownership" class="nav-link">Ownership</a>
        <a href="/squads" class="nav-link">Squads</a>
        <a href="/live" class="nav-link nav-link--live">ðŸ”´ Live</a>
      </div>

      <div id="auth-section" class="nav-auth">
        <span class="nav-auth-loading">Loading...</span>
      </div>
    </div>
  </nav>
</header>

<style>
  .nav-header {
    position: sticky;
    top: 0;
    z-index: 100;
    background: var(--color-surface);
    border-bottom: 1px solid var(--color-border);
  }

  .nav {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-4);
    max-width: var(--container-max);
    margin: 0 auto;
    padding: var(--space-3) var(--space-4);
  }

  .nav-brand {
    font-size: var(--text-lg);
    font-weight: 700;
    color: var(--color-text);
    text-decoration: none;
    white-space: nowrap;
  }

  .nav-brand:hover {
    color: var(--color-primary);
    text-decoration: none;
  }

  /* Hamburger toggle */
  .nav-toggle {
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 5px;
    width: var(--touch-target);
    height: var(--touch-target);
    padding: var(--space-2);
    background: transparent;
    border: none;
    cursor: pointer;
  }

  .nav-toggle-bar {
    display: block;
    width: 22px;
    height: 2px;
    background: var(--color-text);
    border-radius: 2px;
    transition: transform var(--transition-base), opacity var(--transition-base);
  }

  .nav-toggle[aria-expanded="true"] .nav-toggle-bar:nth-child(1) {
    transform: translateY(7px) rotate(45deg);
  }

  .nav-toggle[aria-expanded="true"] .nav-toggle-bar:nth-child(2) {
    opacity: 0;
  }

  .nav-toggle[aria-expanded="true"] .nav-toggle-bar:nth-child(3) {
    transform: translateY(-7px) rotate(-45deg);
  }

  /* Mobile menu (off-canvas) */
  .nav-menu {
    position: fixed;
    inset: 0;
    top: 57px; /* Height of nav header */
    background: var(--color-surface);
    padding: var(--space-4);
    transform: translateX(100%);
    transition: transform var(--transition-base);
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: var(--space-6);
  }

  .nav-menu.is-open {
    transform: translateX(0);
  }

  .nav-links {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
  }

  .nav-link {
    display: flex;
    align-items: center;
    min-height: var(--touch-target);
    padding: var(--space-3);
    font-size: var(--text-base);
    font-weight: 500;
    color: var(--color-text);
    text-decoration: none;
    border-radius: var(--radius-md);
    transition: background var(--transition-fast);
  }

  .nav-link:hover,
  .nav-link:focus {
    background: var(--color-surface-alt);
    text-decoration: none;
  }

  .nav-link--live {
    color: var(--color-danger);
    font-weight: 600;
  }

  .nav-auth {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
    padding-top: var(--space-4);
    border-top: 1px solid var(--color-border);
  }

  .nav-auth-loading {
    font-size: var(--text-sm);
    color: var(--color-text-muted);
  }

  /* Desktop layout */
  @media (min-width: 768px) {
    .nav-toggle {
      display: none;
    }

    .nav-menu {
      position: static;
      transform: none;
      padding: 0;
      flex-direction: row;
      align-items: center;
      gap: var(--space-4);
      background: transparent;
      overflow: visible;
    }

    .nav-links {
      flex-direction: row;
      gap: 0;
    }

    .nav-link {
      padding: var(--space-2) var(--space-3);
      font-size: var(--text-sm);
    }

    .nav-auth {
      flex-direction: row;
      padding-top: 0;
      border-top: none;
    }
  }
</style>

<script>
  import { supabase } from '../lib/supabase.ts'

  const authSection = document.getElementById('auth-section')
  const hamburger = document.getElementById('hamburger-btn')
  const navMenu = document.getElementById('nav-menu')

  // Hamburger toggle
  hamburger?.addEventListener('click', () => {
    const isOpen = navMenu?.classList.toggle('is-open')
    hamburger.setAttribute('aria-expanded', isOpen ? 'true' : 'false')
  })

  // Close menu on link click
  navMenu?.querySelectorAll('.nav-link').forEach(link => {
    link.addEventListener('click', () => {
      navMenu?.classList.remove('is-open')
      hamburger?.setAttribute('aria-expanded', 'false')
    })
  })

  // Close menu on outside click
  document.addEventListener('click', (e) => {
    if (
      hamburger &&
      navMenu &&
      !hamburger.contains(e.target as Node) &&
      !navMenu.contains(e.target as Node)
    ) {
      navMenu.classList.remove('is-open')
      hamburger.setAttribute('aria-expanded', 'false')
    }
  })

  async function updateAuthUI() {
    const { data: { user } } = await supabase.auth.getUser()

    if (user) {
      authSection.innerHTML = `
        <span class="nav-user">${user.email}</span>
        <button id="logout-btn" class="btn btn--danger" type="button">Logout</button>
      `

      document.getElementById('logout-btn')?.addEventListener('click', async () => {
        await supabase.auth.signOut()
        window.location.href = '/login'
      })
    } else {
      authSection.innerHTML = `
        <a href="/login" class="btn btn--primary">Login</a>
        <a href="/signup" class="btn btn--success">Sign Up</a>
      `
    }
  }

  updateAuthUI()

  supabase.auth.onAuthStateChange((event, session) => {
    updateAuthUI()
  })
</script>
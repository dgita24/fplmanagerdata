<html>
  <head>
    <title>Multi-Manager Lookup</title>
    <meta http-equiv="Cache-Control" content="no-store" />
    <style>
      body { font-family: sans-serif; margin: 2em; }
      textarea { width: 20em; height: 6em; }
      #output { margin-top: 1em; }
      .error { color: red; }
      pre { background: #eee; padding: 0.5em; }
    </style>
  </head>
  <body>
    <h1>FPL Manager Data Lookup</h1>
    <form id="lookup-form">
      <label for="manager-ids">
        Enter manager IDs (one per line):
      </label><br>
      <textarea id="manager-ids" placeholder="44&#10;200&#10;1320"></textarea><br>
      <button type="submit">Fetch</button>
    </form>
    <div id="output"></div>
    <script>
      const baseApi = "/api/manager.json";
      const form = document.getElementById('lookup-form');
      const textarea = document.getElementById('manager-ids');
      const output = document.getElementById('output');

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        output.innerHTML = '';
        let ids = textarea.value
          .split(/\s+/)
          .map(x => x.trim())
          .filter(x => /^\d+$/.test(x));
        if (ids.length === 0) {
          output.innerHTML = '<div class="error">Please enter at least one valid manager ID.</div>';
          return;
        }
        if (ids.length > 10) {
          output.innerHTML = '<div class="error">Please enter 10 or fewer IDs at a time.</div>';
          return;
        }
        output.innerHTML = 'Loading...';
        const results = [];
        for (const id of ids) {
          output.innerHTML = `Loading manager ID ${id}... (${results.length+1}/${ids.length})`;
          try {
            const resp = await fetch(`${baseApi}?id=${id}`);
            const data = await resp.json();
            results.push({ id, ok: resp.ok, data });
          } catch (err) {
            results.push({ id, ok: false, data: { error: err.message } });
          }
        }
        let html = "<h2>Results</h2>";
        html += `<table><tr>
          <th>ID</th>
          <th>Team</th>
          <th>Player</th>
          <th>Overall</th>
          <th>Error</th>
          </tr>`;
        for (const r of results) {
          html += `<tr>
            <td>${r.id}</td>
            <td>${r.ok ? r.data.team_name || "" : ""}</td>
            <td>${r.ok ? (r.data.player_first_name || "") + " " + (r.data.player_last_name || "") : ""}</td>
            <td>${r.ok ? (r.data.summary_overall_points ?? "") + " (" + (r.data.summary_overall_rank ?? "") + ")" : ""}</td>
            <td class="error">${!r.ok ? (r.data.error || "API error") : ""}</td>
          </tr>`;
        }
        html += "</table>";
        output.innerHTML = html;
      });
    </script>
  </body>
</html>

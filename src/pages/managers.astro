---
import Layout from "../layouts/Layout.astro";
import Nav from "../components/Nav.astro";
---
<Layout title="Manager IDs Setup - FPL Manager Watch">
  <Nav />

  <main class="page">

    <div id="loading" class="card">
      <div class="card-body text-center">
        <p class="text-muted">Checking authentication...</p>
      </div>
    </div>

    <div id="require-login" class="card" style="display: none;">
      <div class="card-body text-center">
        <h2 class="card-title">Login Required</h2>
        <p class="text-muted">You need to be logged in to manage your manager IDs.</p>
        <div style="margin-top: var(--space-4);">
          <a href="/login" class="btn btn--primary">Go to Login</a>
        </div>
      </div>
    </div>

    <div id="auth-check" style="display: none;">
      <!-- Quick Start - Compact -->
      <section class="card card--compact">
        <div class="card-body card-body--compact">
          <h2 class="card-title card-title--small">Quick Start: Manager IDs Setup</h2>
          <ol class="help-list help-list--compact">
            <li>Add EntryIDs manually (<strong>one per line</strong>, max 50) <em>or</em> use <strong>Import from league</strong></li>
            <li>Changes save automatically ‚Äî IDs sync across devices</li>
          </ol>

          <p class="tip tip--compact">
            <strong>Tip:</strong> Find IDs in official FPL URLs:
          </p>
          <code class="code-block code-block--compact">
            <strong><em class="qs-hl">Manager ID</em></strong> -
            fantasy.premierleague.com/entry/<strong class="qs-hl"><em>1234</em></strong>/event/01<br />
            <strong><em class="qs-hl">League ID</em></strong> -
            fantasy.premierleague.com/leagues/<strong class="qs-hl"><em>1234</em></strong>/standings/c
          </code>
        </div>
      </section>

      <!-- Entry IDs -->
      <section class="card">
        <div class="card-body">
          <form id="manager-form">
            <div class="ids-header">
              <label class="label" for="ids">
                 Manager EntryIDs <span class="ids-count-inline">(<strong id="count">0</strong>)</span>
              </label>
              <button type="button" id="manager-sources-open" class="btn-icon-info" title="View manager sources">‚ÑπÔ∏è</button>
            </div>

            <div class="ids-layout">
              <div class="ids-textarea-wrapper">
                <textarea
                  id="ids"
                  class="textarea"
                  rows="10"
                  placeholder="44&#10;200&#10;1320&#10;..."
                  disabled
                ></textarea>
              </div>

              <div class="ids-actions">
                <button type="button" id="edit-btn" class="btn btn--neutral btn--full-width">Edit Manager IDs</button>
                <button type="submit" id="save-btn" class="btn btn--success btn--full-width" disabled>üíæ Save</button>

                <button type="button" id="featured-open" class="btn btn--featured btn--full-width">
                  Browse featured managers
                </button>

                <button type="button" id="league-open" class="btn btn--league btn--full-width">
                  Import from mini league
                </button>
                <button type="button" id="manager-leagues-open" class="btn btn--league btn--full-width">
                  Import leagues from any manager
                </button>
              </div>
            </div>
          </form>
          <div id="status" style="margin-top: var(--space-3);"></div>
        </div>
      </section>

      <!-- Manager Sources Sheet -->
      <section id="manager-sources-sheet" class="top-sheet" aria-hidden="true">
        <div class="top-sheet__header">
          <div>
            <div class="top-sheet__title">Manager sources</div>
            <div class="top-sheet__subtitle">View where each manager was imported from</div>
          </div>
          <button type="button" id="manager-sources-close" class="top-sheet__close" aria-label="Close">‚úï</button>
        </div>

        <div class="top-sheet__body">
          <div class="control" style="margin-bottom: var(--space-2);">
            <input id="manager-sources-search" class="input" type="text" placeholder="Search by ID or name..." autocomplete="off" />
          </div>

          <div id="manager-sources-list" class="manager-sources-list"></div>
        </div>
      </section>


      <!-- Featured managers top sheet (non-blocking; keeps textarea editable) -->
      <section id="featured-sheet" class="top-sheet" aria-hidden="true">
        <div class="top-sheet__header">
          <div>
            <div class="top-sheet__title">Featured managers</div>
            <div class="top-sheet__subtitle">Tick/untick manager(s), then 'Apply changes' Click on a manager's name to see past season's final rankings.</div>
          </div>

          <button type="button" id="featured-close" class="top-sheet__close" aria-label="Close">
            ‚úï
          </button>
        </div>

        <div class="top-sheet__body">
          <div class="control" style="margin-bottom: var(--space-2);">
            <label class="label" for="featured-search">Search</label>
            <input
              id="featured-search"
              class="input"
              placeholder="Search featured managers‚Ä¶"
              autocomplete="off"
            />
          </div>
          <div id="featured-list" class="featured-list"></div>
        </div>

        <div class="top-sheet__footer">
          <div id="featured-delta" class="top-sheet__status" aria-live="polite"></div>
          <div id="featured-status" class="top-sheet__status" aria-live="polite"></div>
          <div class="top-sheet__actions">
            <button type="button" id="featured-clear" class="btn btn--neutral">Clear</button>
            <button type="button" id="featured-apply" class="btn btn--success" disabled>
              Apply changes
            </button>
          </div>
        </div>
      </section>

      <!-- Manager history sheet -->
      <section id="manager-history-sheet" class="top-sheet" aria-hidden="true">
        <div class="top-sheet__header">
          <div>
            <div id="manager-history-title" class="top-sheet__title">Manager history</div>
            <div class="top-sheet__subtitle">Season-ending ranks from previous years.</div>
            <div id="manager-history-summary" class="top-sheet__subtitle manager-history-summary"></div>
          </div>
          <button type="button" id="manager-history-close" class="top-sheet__close" aria-label="Close">‚úï</button>
        </div>

        <div class="top-sheet__body">
          <div id="manager-history-status" class="top-sheet__status" aria-live="polite"></div>
          <div id="manager-history-list" class="manager-history-list"></div>
        </div>
      </section>

      <!-- League import sheet (save league IDs, choose a league) -->
      <section id="league-sheet" class="top-sheet" aria-hidden="true">
        <div class="top-sheet__header">
          <div>
            <div class="top-sheet__title">Import from league</div>
            <div class="top-sheet__subtitle">Import and save a league, then choose manager(s) to add to your list.</div>
          </div>
          <button type="button" id="league-close" class="top-sheet__close" aria-label="Close">‚úï</button>
        </div>

        <div class="top-sheet__body">
          <div class="control" style="margin-bottom: var(--space-2);">
            <label class="label" for="league-id-input">League ID</label>
            <input id="league-id-input" class="input" inputmode="url" autocapitalize="off" autocomplete="off" spellcheck="false" placeholder="League ID, e.g. 67893 or League URL" />
            <div class="text-muted" style="margin-top: 6px; font-size: var(--text-sm);">
              Tip: Use URL or ID within URL <code>fantasy.premierleague.com/leagues/<strong>123456</strong>/standings/c</code>
            </div>
          </div>

          <div style="display:flex; gap: var(--space-2); margin-bottom: var(--space-1);">
            <button type="button" id="league-save" class="btn btn--success">Save league</button>
            <button type="button" id="league-refresh" class="btn btn--neutral">Refresh list</button>
          </div>

          <div id="league-status" class="top-sheet__status" aria-live="polite"></div>

          <div style="margin-top: var(--space-1);">
            <div class="text-muted" style="margin-bottom: var(--space-2);">Saved leagues</div>
            <div id="league-list" class="featured-list"></div>
          </div>
        </div>

        <div class="top-sheet__footer">
          <div class="top-sheet__status">
            Open a league to select/deselect manager(s). Changes apply to your manager list.
          </div>
        </div>
      </section>

      <section id="manager-leagues-sheet" class="top-sheet" aria-hidden="true">
        <div class="top-sheet__header">
          <div>
            <div class="top-sheet__title">Import leagues from manager</div>
            <div class="top-sheet__subtitle">Enter a <strong><em>Manager ID</em></strong>, then choose which leagues to save. Remove leagues in the 'Import from mini league' sheet.</div>
          </div>
          <button type="button" id="manager-leagues-close" class="top-sheet__close" aria-label="Close">‚úï</button>
        </div>

        <div class="top-sheet__body">
          <div class="control" style="margin-bottom: var(--space-2);">
            <label class="label" for="manager-leagues-entry">Manager ID</label>
            <input id="manager-leagues-entry" class="input" inputmode="url" autocapitalize="off" autocomplete="off" spellcheck="false" placeholder="Manager ID or URL" />
            <div class="text-muted" style="margin-top: 6px; font-size: var(--text-sm);">
              Tip: Use URL or ID within URL <code>fantasy.premierleague.com/entry/<strong>123456</strong>/event/01</code>
            </div>
          </div>

          <div style="display:flex; gap: var(--space-2); margin-bottom: var(--space-1);">
            <button type="button" id="manager-leagues-fetch" class="btn btn--success">Fetch leagues</button>
          </div>

          <div id="manager-leagues-status" class="top-sheet__status" aria-live="polite"></div>

          <div id="manager-leagues-list" class="featured-list"></div>
         </div>

        <div class="top-sheet__footer">
          <div class="top-sheet__status" aria-live="polite">Max saved leagues: 15</div>
          <div class="top-sheet__actions">
            <button type="button" id="manager-leagues-apply" class="btn btn--success" disabled>
              Save selected leagues
            </button>
          </div>
        </div>
      </section>

      <!-- League standings sheet (tick/untick managers, then apply) -->
      <section id="league-standings-sheet" class="top-sheet" aria-hidden="true">
        <div class="top-sheet__header">
          <div>
            <div id="league-standings-title" class="top-sheet__title">League standings</div>
            <div id="league-standings-subtitle" class="top-sheet__subtitle"></div>
          </div>
          <button type="button" id="league-standings-close" class="top-sheet__close" aria-label="Close">‚úï</button>
        </div>

        <div class="top-sheet__body">
          <div id="league-standings-banner" class="top-sheet__status" aria-live="polite"></div>

          <div class="control" style="margin-bottom: var(--space-2);">
            <label class="label" for="league-search">Search</label>
            <input
              id="league-search"
              class="input"
              placeholder="Search team, manager, or EntryID‚Ä¶"
              autocomplete="off"
            />
          </div>
 
          <div id="league-standings-list" class="featured-list"></div>
        </div>

        <div class="top-sheet__footer">
          <div id="league-apply-success" class="top-sheet__status" aria-live="polite"></div>
          <div id="league-apply-status" class="top-sheet__status" aria-live="polite"></div>
          <div class="top-sheet__actions">
            <button type="button" id="league-select-none" class="btn btn--neutral">Select none</button>
            <button type="button" id="league-apply" class="btn btn--success" disabled>Apply changes</button>
          </div>
        </div>
      </section>
    </div>
  </main>
</Layout>


<style is:global>
  .input {
    width: 100%;
    padding: 10px 12px;
    border-radius: var(--radius-md);
    border: 1px solid rgba(255, 255, 255, 0.12);
    background: rgba(255, 255, 255, 0.04);
    color: inherit;
    outline: none;
  }

  .input:focus {
    border-color: rgba(59, 130, 246, 0.65);
  }

  /* Quick Start highlight tokens */
  .code-block--compact .qs-hl {
    color: var(--color-warning);
    font-family: var(--font-sans);
    font-weight: 800 !important;
    font-style: italic;
    font-size: 1.10em;
  }

  #manager-leagues-sheet .top-sheet__subtitle strong {
    color: var(--color-warning);
    font-weight: 800;
  }

  .card--compact {
    margin-bottom: var(--space-2);
  }

  .card-body--compact {
    padding: var(--space-2) var(--space-3);
  }

  .card-title--small {
    font-size: var(--text-sm);
    margin-bottom: var(--space-2);
  }

  .help-list--compact {
    padding-left: var(--space-4);
    display: flex;
    flex-direction: column;
    gap: 2px;
    font-size: var(--text-xs);
    color: var(--color-text-secondary);
    margin-bottom: var(--space-1);
  }

  .tip--compact {
    font-size: var(--text-xs);
    margin-top: 0;
    margin-bottom: 2px;
  }

  .code-block--compact {
    display: block;
    padding: var(--space-1) var(--space-2);
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    background: var(--color-surface-alt);
    border-radius: var(--radius-sm);
    word-break: break-all;
    overflow-wrap: break-word;
    line-height: 1.4;
  }

  .ids-layout {
    display: flex;
    flex-direction: row;
    gap: var(--space-4);
    margin-top: 0;
    align-items: flex-start;
  }

  .ids-textarea-wrapper {
    width: clamp(165px, 42vw, 220px);
    flex-shrink: 0;
  }

  .ids-textarea-wrapper .textarea {
    width: 100%;
    font-size: var(--text-sm);
    min-height: 380px;
  }

  .ids-actions {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
    width: 140px;
  }

  .ids-header {
    margin-bottom: var(--space-2);
  }

  .btn-icon-info {
    border: none;
    background: transparent;
    font-size: 0.85rem;
    cursor: pointer;
    padding: 2px 6px;
    margin-left: 4px;

    color: #60a5fa;            /* blue-400 */
    opacity: 0.95;
    transition: opacity 0.15s ease, color 0.15s ease;

    vertical-align: middle;
    line-height: 1;
    border-radius: 8px;         /* so focus ring looks clean */
  }

  .btn-icon-info:hover {
    color: #93c5fd;            /* blue-300 */
    opacity: 1;
  }

  .btn-icon-info:focus-visible {
    outline: 2px solid rgba(96, 165, 250, 0.55);
    outline-offset: 2px;
  }

  .manager-sources-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    /* Ensure checkboxes stay blue when checked */
    input[type="checkbox"]:checked {
      accent-color: var(--color-primary);
    }

    .loading-spinner {
      display: inline-block;
      width: 14px;
      height: 14px;
      border: 2px solid var(--color-border);
      border-top-color: var(--color-primary);
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
      vertical-align: middle;
      margin-right: 6px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .manager-source-item {
      padding: 10px 12px;
      border: 1px solid var(--color-border);
      border-radius: 6px;
      background: var(--color-bg);
      line-height: 1.4;
    }

    .manager-source-item__header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
    }

    .manager-source-item__name {
      font-size: 0.95rem;
      font-weight: 500;
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .manager-source-item__id {
      font-family: monospace;
      font-size: 0.85rem;
      color: var(--color-primary);
      font-weight: 600;
      flex-shrink: 0;
    }

    .manager-source-item__source {
      margin-top: 4px;
      font-size: 0.85rem;
      color: var(--color-text-muted);
    }

    .manager-source-item__footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 4px;
      gap: 8px;
    }

    .manager-source-item__delete {
      border: none;
      background: transparent;
      font-size: 0.95rem;
      cursor: pointer;
      padding: 4px;
      opacity: 0.5;
      transition: opacity 0.15s ease;
      flex-shrink: 0;
    }

    .manager-source-item__delete:hover {
      opacity: 1;
    }

    /* Make the sheet narrower on desktop, fullscreen on mobile */
    #manager-sources-sheet.top-sheet {
      max-width: 500px;
    }

    @media (max-width: 640px) {
      #manager-sources-sheet.top-sheet {
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        max-width: 100%;
        height: 100vh;
        height: 100dvh;
        max-height: 100dvh;
        border-bottom-left-radius: 0;
        border-bottom-right-radius: 0;
      }

      #manager-sources-sheet .top-sheet__header {
        padding-top: calc(var(--space-3) + env(safe-area-inset-top));
      }
    }
  .ids-count-inline {
    font-size: inherit;
    font-weight: inherit;
    color: var(--color-text-secondary);
    margin-left: var(--space-1);
  }

  .ids-count-inline strong {
    color: var(--color-success);
    font-weight: inherit;
  }
  
  .btn--full-width {
    width: 100%;
  }

  /* Managers page: slightly taller action buttons on tablet/desktop */
  @media (min-width: 640px) {
    .ids-actions .btn {
      min-height: 44px;              /* taller tap target */
      padding-top: 12px;
      padding-bottom: 12px;
    }
  }

  #edit-btn {
    white-space: normal;      /* overrides Layout's .btn { white-space: nowrap } */
    overflow-wrap: anywhere;
    line-height: 1.15;
    font-size: 0.9rem;

    background: #020617;        /* slate-950 */
    color: #e5e7eb;             /* gray-200 */
    border: 1px solid #1f2937;  /* gray-800 */
  }


  #edit-btn:hover {
    border-color: #374151;
  }

  #edit-btn:focus-visible {
    outline: 2px solid rgba(148, 163, 184, 0.55); /* slate-ish */
    outline-offset: 2px;
  }

  /* Save (emerald) */
  #save-btn {
    background: #10b981;        /* emerald-500 */
    color: #ecfdf5;             /* emerald-50 */
    border: 1px solid #065f46;  /* emerald-800 */
  }

  #save-btn:hover {
    background: #059669;        /* emerald-600 */
  }

  #save-btn:focus-visible {
    outline: 2px solid rgba(16, 185, 129, 0.55);
    outline-offset: 2px;
  }

  /* Browse featured managers (indigo) */
  #featured-open {
    background: #312e81;        /* indigo-900 */
    color: #e0e7ff;             /* indigo-100 */
    border: 1px solid #4338ca;  /* indigo-600 */
  }

  #featured-open:hover {
    background: #3730a3;        /* indigo-800 */
  }

  #featured-open:focus-visible {
    outline: 2px solid rgba(99, 102, 241, 0.55); /* indigo-500-ish */
    outline-offset: 2px;
  }

  /* Import from mini league: uses base orange from .btn--league (no override) */
  #league-open { }

  /* Import leagues from any manager: slightly deeper orange variant */
  #manager-leagues-open {
    background: #9a3412;        /* orange-800 */
    border-color: #7c2d12;      /* orange-900 */
  }

  #manager-leagues-open:hover {
    background: #c2410c;        /* orange-700 */
  }

  #manager-leagues-open:focus-visible {
    outline: 2px solid rgba(234, 88, 12, 0.65); /* orange-600 */
    outline-offset: 2px;
  }



  .textarea:disabled {
    background: var(--color-surface-alt);
    opacity: 0.7;
    cursor: not-allowed;
  }

  /* Custom button variant for "Browse featured managers" */
  .btn--featured {
    white-space: normal;
    overflow-wrap: anywhere;
    word-break: break-word;
    text-align: center;
    line-height: 1.15;
    padding-top: 10px;
    padding-bottom: 10px;
  }

    /* Base style for "Import" buttons */
  .btn--league {
    background: #ea580c;        /* orange-600 */
    color: #f9fafb;             /* near-white */
    border: 1px solid rgba(0, 0, 0, 0.35);

    white-space: normal;
    overflow-wrap: anywhere;
    word-break: break-word;
    text-align: center;
    line-height: 1.15;
    padding-top: 10px;
    padding-bottom: 10px;
  }

  .btn--league:hover {
    background: #f97316;        /* orange-500 */
  }

  .btn--league:active {
    background: #c2410c;        /* orange-700 */
  }

  .btn--league:focus-visible {
    outline: 2px solid rgba(249, 115, 22, 0.7);
    outline-offset: 2px;
  }

  /* --- TOP SHEET --- */
  .top-sheet {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;

    height: 62vh;
    max-height:62vh;

    background: var(--color-surface, #111827);
    border-bottom: 1px solid rgba(255, 255, 255, 0.12);
    z-index: 1000;

    transform: translateY(-105%);
    transition: transform 220ms ease;
    display: grid;
    grid-template-rows: auto 1fr auto;

    box-shadow: 0 12px 28px rgba(0, 0, 0, 0.5);
  }

  .top-sheet.is-open {
    transform: translateY(0);
  }

  .top-sheet__header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: var(--space-3);
    padding: var(--space-3);
  }

  .top-sheet__title {
    font-weight: 700;
  }

  .top-sheet__subtitle {
    color: var(--color-text-muted);
    font-size: var(--text-sm);
    margin-top: 2px;
  }

  .top-sheet__close {
    background: transparent;
    border: 1px solid rgba(255, 255, 255, 0.18);
    color: inherit;
    border-radius: 10px;
    width: 40px;
    height: 40px;
    cursor: pointer;
  }

  #featured-sheet .top-sheet__close,
  #manager-leagues-sheet .top-sheet__close,
  #league-sheet .top-sheet__close,
  #league-standings-sheet .top-sheet__close {
    width: 56px;
    height: 40px;
    min-width: 56px;
    flex: 0 0 56px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-weight: 900;
    font-size: 1.3rem;
    background: rgba(255, 255, 255, 0.08);
  }

  .top-sheet__body {
    overflow: auto;
    padding: 0 var(--space-3) var(--space-3);
    -webkit-overflow-scrolling: touch;
  }

  .featured-list {
    display: grid;
    gap: var(--space-2);
  }

  .featured-item {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 4px 8px;

    padding: 6px var(--space-2);
    border: 1px solid rgba(255, 255, 255, 0.10);
    border-radius: var(--radius-md);
    background: rgba(255, 255, 255, 0.03);

    font-size: 0.92em;
    line-height: 1.2;

    align-items: center;
  }

  .featured-item__name {
    font-weight: 700;
    font-size: 0.9em;
    min-width: 0;
    overflow-wrap: anywhere;
  }

  .featured-item__note {
    color: var(--color-text-muted);
    font-size: 0.95em;
    min-width: 0;
    overflow-wrap: anywhere;
  }

  .featured-item__id {
    margin-left: auto;
    flex-shrink: 0;
    overflow-wrap: anywhere;
  }

  .featured-item__id code {
    font-family: var(--font-mono);
    font-size: 0.95em;
    white-space: nowrap;
  }

  .featured-item__name-button {
    background: transparent;
    border: none;
    padding: 0;
    margin: 0;
    color: var(--color-primary);
    font: inherit;
    cursor: pointer;
    text-align: left;
  }

  .featured-item__name-button:hover {
    color: #93c5fd; /* light blue */
    text-decoration: underline;
  }

  .featured-item__name-button:hover {
    text-decoration: underline;
  }

  .manager-history-list {
    display: grid;
    gap: var(--space-2);
  }

  .manager-history-row {
    display: grid;
    grid-template-columns: 1fr 1.05fr 1.15fr; /* give points more space */
    column-gap: 6px; /* tighter between season + points */
    padding: 8px 10px;
    border: 1px solid rgba(255, 255, 255, 0.12);
    border-radius: var(--radius-md);
    background: rgba(255, 255, 255, 0.03);
  }

  .manager-history-col {
    padding: 0 6px;
    border-right: 1px solid rgba(255, 255, 255, 0.12);
    font-size: var(--text-sm);
  }

  .manager-history-col--season {
    font-weight: 700;
    padding-left: 0;
  }

  .manager-history-col--points {
    color: var(--color-text-muted);
    padding-right: 12px;
    white-space: nowrap;
  }

  .manager-history-col--rank {
    border-right: none;
    font-weight: 600;
  }

  .manager-history-summary {
    display: grid;
    gap: 2px;
  }


  /* Saved leagues: force 2-row layout (title row, then actions row) */
  #league-sheet #league-list .saved-league-card {
    flex-direction: column;
    align-items: stretch;
  }

  #league-sheet #league-list .saved-league-title {
    display: block; /* natural wrapping */
    min-width: 0;
  }

  #league-sheet #league-list .saved-league-actions {
    display: flex;
    justify-content: space-between; /* Open left, Remove right */
    gap: var(--space-2);
    margin-top: var(--space-1);
    align-items: center;

  }

  /* Push Remove to the far right, keep buttons compact */
  #league-sheet #league-list .saved-league-actions .btn:last-child {
    margin-left: auto;
  }


  .featured-item .featured-check,
  .featured-item .league-check {
    flex-shrink: 0;
    transform: scale(0.95);
  }

  #manager-leagues-sheet input[type="checkbox"] {
    accent-color: var(--color-primary);
  }

  .top-sheet__footer {
    border-top: 1px solid rgba(255, 255, 255, 0.10);
    padding: var(--space-2) var(--space-3);
    background: rgba(0, 0, 0, 0.15);
  }

  .top-sheet__status {
    min-height: 1.2em;
    color: var(--color-text-muted);
    font-size: var(--text-sm);
    margin-bottom: var(--space-2);
  }

  .top-sheet__actions {
    display: flex;
    gap: var(--space-2);
    justify-content: flex-end;
  }

  #featured-apply {
    white-space: nowrap;
    min-width: 0;
  }

  /* =========================
   MOBILE (<= 639px)
   ========================= */
  @media (max-width: 639px) {
    /* Make the Manager EntryIDs form fill within its card */
    .card-body > #manager-form {
      display: flex;
      flex-direction: column;
    }

    .ids-layout {
      display: flex;
      flex-direction: row;
      align-items: stretch;
      gap: var(--space-3);
    }

    .ids-textarea-wrapper,
    .ids-actions {
      display: flex;
      flex-direction: column;
    }

    /* Mobile: size textarea relative to viewport so the card grows */
    .ids-textarea-wrapper .textarea {
      width: 100%;
      font-size: var(--text-sm);
      height: min(44dvh, 380px);   /* TALLER than before */
      min-height: 260px;
      max-height: 520px;
      resize: none;
    }

    /* Make all four buttons share equal height and match textarea column height */
    .ids-actions {
      gap: var(--space-2);
    }

    .ids-actions .btn {
      flex: 1 1 0;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 0;
    }

    /* MOBILE-only: tighten the 3 gaps on the EntryIDs card */
    .ids-header {
      margin-top: clamp(-8px, -1.6vw, -4px);
      margin-bottom: clamp(4px, 1.2vw, 8px);
    }

    .ids-layout {
      gap: clamp(8px, 2.2vw, 14px);
    }

    .ids-actions {
      gap: clamp(8px, 2.2vw, 12px);
    }

    /* Remove the reserved gap from: <div id="status" style="margin-top: var(--space-3);"></div> */
    #status:empty { display: none; }
    #status { margin-top: clamp(6px, 1.6vw, 12px) !important; }

    /* Make the right-column buttons more compact on mobile (padding/font) */
    .ids-actions .btn {
      min-height: 38px;
      padding: 8px 12px;
      font-size: 0.85rem;
    }

    /* Mobile-only: make the top 3 buttons shorter to reduce total card height */
    #edit-btn,
    #save-btn,
    #featured-open {
      min-height: 32px;
      padding-top: 6px;
      padding-bottom: 6px; 
    }

    /* Mobile-only: make the two bottom import buttons taller */
    #league-open,
    #manager-leagues-open {
      min-height: clamp(42px, 10vw, 50px);
      padding-top: clamp(9px, 2.2vw, 12px);
      padding-bottom: clamp(9px, 2.2vw, 12px);
    }

    /* IMPORTANT: these must remain INSIDE the media query */
    #edit-btn { font-size: 0.85rem; }

    .ids-actions .btn--featured,
    .ids-actions .btn--league {
      line-height: 1.1;
      padding-top: 8px;
      padding-bottom: 8px;
    }

    #league-sheet .text-muted code {
      display: inline-block;
      max-width: 100%;
      white-space: normal;
      overflow-wrap: anywhere;
      word-break: break-word;
    }

    #league-sheet #league-id-input::placeholder {
      font-size: 0.75em;
    }

    /* Fullscreen Featured managers sheet on mobile (like league sheets) */
    #featured-sheet.top-sheet {
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      height: 100vh;   /* fallback */
      height: 100dvh;  /* better on mobile browsers */
      max-height: 100dvh;
      border-bottom-left-radius: 0;
      border-bottom-right-radius: 0;
    }

    /* Notch-safe padding */
    #featured-sheet .top-sheetheader {
      padding-top: calc(var(--space-3) + env(safe-area-inset-top));
    }

    #featured-sheet .top-sheetfooter {
      padding-bottom: calc(var(--space-2) + env(safe-area-inset-bottom));
    }

    /* Compact saved leagues rows in the import sheet */
    #league-sheet .featured-item,
    #manager-leagues-sheet .featured-item {
      padding-top: 6px;
      padding-bottom: 6px;
    }

    /* Compact standings rows too */
    #league-standings-sheet .featured-item {
      padding-top: 6px;
      padding-bottom: 6px;
    }

    /* FORCE compact buttons inside ALL top-sheet modals on mobile
       (this overrides Layout.astro's global .btn sizing) */
    #league-sheet .btn,
    #league-standings-sheet .btn,
    #featured-sheet .btn,
    #manager-leagues-sheet .btn {
      min-height: 34px !important;
      padding: 6px 10px !important;
      font-size: 0.85rem !important;
    }

    #manager-leagues-sheet code {
      display: inline-block;
      max-width: 100%;
      overflow-wrap: anywhere;
      word-break: break-all;
    }

    /* FIX: Tighter spacing in league import sheet */
    #league-sheet .control {
      gap: var(--space-1);
      margin-bottom: var(--space-1);
    }

    #league-sheet .input {
      min-height: 36px;
      padding: 6px 10px;
    }

    #league-sheet .text-muted {
      margin-top: 4px !important;
      margin-bottom: 0 !important;
    }
  
    /* Remove the reserved gap when status is empty */
    #league-sheet #league-status:empty {
      display: none;
    }

    /* When it does show, keep it tight */
    #league-sheet #league-status {
      min-height: 0 !important;
      margin: 0 0 var(--space-1) 0 !important;
    }

    /* Fullscreen the two league sheets on mobile */
    #league-sheet.top-sheet,
    #league-standings-sheet.top-sheet,
    #manager-leagues-sheet.top-sheet,
    #manager-history-sheet.top-sheet {
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;

      height: 100vh;    /* fallback */
      height: 100dvh;   /* preferred */
      max-height: 100dvh;

      border-bottom-left-radius: 0;
      border-bottom-right-radius: 0;
    }

    /* Notch / safe-area padding */
    #league-sheet .top-sheet__header,
    #league-standings-sheet .top-sheet__header,
    #manager-leagues-sheet .top-sheet__header {
      padding-top: calc(var(--space-3) + env(safe-area-inset-top));
    }

    #league-sheet .top-sheet__footer,
    #league-standings-sheet .top-sheet__footer,
    #manager-leagues-sheet .top-sheet__footer {
      padding-bottom: calc(var(--space-2) + env(safe-area-inset-bottom));
    }

    /* Saved league name smaller */
    #league-sheet #league-list .featured-item__name {
      font-size: 0.85rem;
      line-height: 1.15;
    }

    #league-sheet #league-list .featured-item__note {
      font-size: 0.8rem;
    }
  }




  /* =========================
     DESKTOP (>= 640px)
     ========================= */
  @media (min-width: 640px) {
    .page {
      align-items: stretch;
    }

    /* Desktop-only: shallower buttons in league sheets (does not affect mobile) */
    #league-sheet .btn,
    #league-standings-sheet .btn {
      min-height: 32px !important;
      padding: 6px 10px !important;
      font-size: 0.85rem !important;
    }

    #auth-check {
      display: flex;
      flex-direction: column;
      align-items: stretch;
      width: 100%;
    }

    #auth-check .card {
      width: min(820px, 100%);
      margin-inline: auto;
    }

    /* Responsive two-column layout for the IDs textarea + actions */
    .ids-layout {
      display: grid;
      grid-template-columns: minmax(280px, 1fr) minmax(170px, 220px);
      gap: var(--space-4);
      align-items: stretch;
    }

    .ids-textarea-wrapper {
      width: auto;
      flex-shrink: initial;
    }

    .ids-actions {
      width: auto;
      height: 100%;

      display: grid;
      grid-auto-rows: 1fr;          /* every button row same height */
      gap: 8px;                     /* small, consistent gap (adjust if you want) */
      align-content: stretch;
    }

    /* Make each action button fill its grid row */
    .ids-actions .btn {
      height: 100%;
      width: 100%;
      justify-content: center;
    }

    .top-sheet {
      height: 88vh;
      max-height: 88vh;
      left: 50%;
      right: auto;
      width: min(820px, 96vw);
      transform: translate(-50%, -105%);
      border-left: 1px solid rgba(255, 255, 255, 0.12);
      border-right: 1px solid rgba(255, 255, 255, 0.12);
      border-bottom-left-radius: var(--radius-lg);
      border-bottom-right-radius: var(--radius-lg);
    }

    .top-sheet.is-open {
      transform: translate(-50%, 0);
    }

    /* Desktop-only compact rows inside sheets */
    #featured-sheet .featured-item,
    #league-sheet .featured-item,
    #league-standings-sheet .featured-item,
    #manager-leagues-sheet .featured-item {
      padding-top: 6px;
      padding-bottom: 6px;
      gap: 4px 8px;
      font-size: 0.9em;
    }
  }

  /* =========================
     VERY SMALL PHONES (<= 360px)
     ========================= */
  @media (max-width: 360px) {
    .ids-layout {
      flex-direction: column;
    }

    .ids-textarea-wrapper {
      width: 100%;
    }

    .ids-actions {
      flex-direction: row;
      flex-wrap: wrap;
      width: 100%;
      gap: var(--space-2);
    }

    .ids-actions .btn--full-width {
      flex: 1;
      min-width: 80px;
    }
  }
</style>

<script>
  
</script>

---
import Layout from "../layouts/Layout.astro";
---
<Layout title="Login - FPL Manager Watch">
  <main class="auth-page">
    <div class="auth-card">
      <h1 class="auth-title">Login</h1>

      <form id="login-form" class="auth-form">
        <div class="control">
          <label class="label" for="email">Email</label>
          <input type="email" id="email" class="input" required />
        </div>

        <div class="password-field">
          <input type="password" id="password" class="input" required />
          <button type="button" id="toggle-password" class="password-toggle" aria-label="Show password">
            üëÅ
          </button>
        </div>

        <div class="remember-row">
          <label class="checkbox-label">
            <input type="checkbox" id="remember-me" checked />
            <span>Remember me</span>
          </label>
        </div>

        <button type="submit" class="btn btn--primary btn--full">Login</button>

        <div id="error-message" class="status status--error" style="display: none;"></div>
        <div id="success-message" class="status status--success" style="display: none;"></div>
      </form>

      <div class="auth-links">
        <a href="/signup">Don't have an account? Sign up</a>
        <a href="/reset-password">Forgot password?</a>
        <a href="/" class="text-muted">‚Üê Back to Home</a>
      </div>
    </div>
  </main>
</Layout>

<style>
  .auth-page {
    min-height: 100dvh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--space-4);
  }

  .auth-card {
    width: 100%;
    max-width: 400px;
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--space-6);
  }

  .auth-title {
    text-align: center;
    font-size: var(--text-2xl);
    margin-bottom: var(--space-6);
    color: var(--color-text);
  }

  .auth-form {
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
  }

  .btn--full {
    width: 100%;
  }

  .remember-row {
    display: flex;
    align-items: center;
  }

  .checkbox-label {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--text-sm);
    color: var(--color-text-secondary);
    cursor: pointer;
  }

  .checkbox-label input[type="checkbox"] {
    width: 16px;
    height: 16px;
    accent-color: var(--color-primary);
  }

  .auth-links {
    margin-top: var(--space-5);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--text-sm);
  }

  .password-field {
    position: relative;
  }

  .password-toggle {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    background: transparent;
    border: none;
    color: var(--color-text-secondary);
    cursor: pointer;
    font-size: 16px;
    padding: 0;
  }
</style>

<script>
  import { supabase } from '../lib/supabase.ts'

  const form = document.getElementById('login-form') as HTMLFormElement
  const passwordInput = document.getElementById('password') as HTMLInputElement
  const togglePasswordBtn = document.getElementById('toggle-password') as HTMLButtonElement
  togglePasswordBtn?.addEventListener('click', () => {
    const isPassword = passwordInput.type === 'password'
    passwordInput.type = isPassword ? 'text' : 'password'
    togglePasswordBtn.textContent = isPassword ? 'üôà' : 'üëÅ'
  })
  const errorMessage = document.getElementById('error-message') as HTMLElement
  const successMessage = document.getElementById('success-message') as HTMLElement

  form.addEventListener('submit', async (e) => {
    e.preventDefault()

    errorMessage.style.display = 'none'
    successMessage.style.display = 'none'

    const email = (document.getElementById('email') as HTMLInputElement).value
    const password = (document.getElementById('password') as HTMLInputElement).value

    const { data, error } = await supabase.auth.signInWithPassword({
      email,
      password,
    })

    if (error) {
      errorMessage.textContent = error.message
      errorMessage.style.display = 'block'
    } else {
      successMessage.textContent = 'Login successful! Redirecting...'
      successMessage.style.display = 'block'

      setTimeout(() => {
        window.location.href = '/managers'
      }, 1000)
    }
  })
</script>

---
import Layout from "../layouts/Layout.astro";
---
<Layout title="Sign Up - FPL Manager Watch">
  <main class="auth-page">
    <div class="auth-card">
      <h1 class="auth-title">Sign Up</h1>

      <form id="signup-form" class="auth-form">
        <div class="control">
          <label class="label" for="email">Email</label>
          <input type="email" id="email" class="input" required />
        </div>

        <div class="control">
          <label class="label" for="password">Password</label>
          <input type="password" id="password" class="input" required minlength="6" />
          <small class="text-muted">Minimum 6 characters</small>
        </div>

        <div class="control">
          <label class="label" for="confirm-password">Confirm Password</label>
          <input type="password" id="confirm-password" class="input" required minlength="6" />
        </div>

        <button type="submit" class="btn btn--success btn--full">Sign Up</button>

        <div id="error-message" class="status status--error" style="display: none;"></div>
        <div id="success-message" class="status status--success" style="display: none;"></div>
      </form>

      <div class="auth-links">
        <a href="/login">Already have an account? Login</a>
        <a href="/" class="text-muted">‚Üê Back to Home</a>
      </div>
    </div>
  </main>
</Layout>

<style>
  .auth-page {
    min-height: 100dvh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--space-4);
  }

  .auth-card {
    width: 100%;
    max-width: 400px;
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--space-6);
  }

  .auth-title {
    text-align: center;
    font-size: var(--text-2xl);
    margin-bottom: var(--space-6);
    color: var(--color-text);
  }

  .auth-form {
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
  }

  .btn--full {
    width: 100%;
  }

  .auth-links {
    margin-top: var(--space-5);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--text-sm);
  }
</style>

<script>
  import { supabase } from '../lib/supabase.ts'

  const form = document.getElementById('signup-form') as HTMLFormElement
  const errorMessage = document.getElementById('error-message') as HTMLElement
  const successMessage = document.getElementById('success-message') as HTMLElement

  form.addEventListener('submit', async (e) => {
    e.preventDefault()

    errorMessage.style.display = 'none'
    successMessage.style.display = 'none'

    const email = (document.getElementById('email') as HTMLInputElement).value
    const password = (document.getElementById('password') as HTMLInputElement).value
    const confirmPassword = (document.getElementById('confirm-password') as HTMLInputElement).value

    if (password !== confirmPassword) {
      errorMessage.textContent = 'Passwords do not match'
      errorMessage.style.display = 'block'
      return
    }

    const { data, error } = await supabase.auth.signUp({
      email,
      password,
      options: {
        emailRedirectTo: `${window.location.origin}/auth/callback`,
      }
    })

    if (error) {
      errorMessage.textContent = error.message
      errorMessage.style.display = 'block'
    } else {
      successMessage.textContent = 'Account created! Please check your email to verify your account.'
      successMessage.style.display = 'block'
      form.reset()
    }
  })
</script>